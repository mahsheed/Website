<!doctype html>
<html>
  <head>
    <title> </title>
    <script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
  </head>
  <body>
    <h1>Shopping Cart</h1>

    <div>
      <ul>
        <li><a class="add-to-cart" href="#" data-name="Apple" data-price="1.22">Apple $1.22</a></li>
        <li><a class="add-to-cart" href="#" data-name="Banana" data-price="1.33">Banana $1.33</a></li>
        <li><a class="add-to-cart" href="#" data-name="Shoe" data-price="22.33">Shoe $22.33</a></li>
        <li><a class="add-to-cart" href="#" data-name="Frisbee" data-price="5.22">Frisbee $5.22</a></li>
      </ul>
      <button id="clear-cart">Clear Cart</button>
    </div>

    <div>
      <ul id="show-cart">
        <li>??????</li>
      </ul>
      <div>Total Cart: $<span id="total-cart"></span></div>
    </div>


    <script>


// displayCart : Function


      $(".add-to-cart").click(function(event){
        event.preventDefault();
        var name = $(this).attr("data-name");
        var price = Number($(this).attr("data-price"));

        shoppingCart.addItemToCart(name, price, 1);
        displayCart();
      });

      $("#clear-cart").click(function(event){
        shoppingCart.clearCart();
        displayCart();
      });

      function displayCart() {
        var cartArray= shoppingCart.listCart ();
        var output = "";

        for (var i in cartArray) {
          output += "<li>"+cartArray[i].name
            +" "+cartArray[i].count
            +" x "+cartArray[i].price
            +" = "+cartArray[i].total
            +" <button class='plus-item' data-name='"
            +cartArray[i].name+"'>+</button>"
            +" <button class='subtract-item' data-name='"
            +cartArray[i].name+"'>-</button>"
            +" <button class='delete-item' data-name='"
            +cartArray[i].name+"'>X</button>"
            +"</li>"; //+= means add to the end of what's alraedy there
        }

        $("#show-cart").html(output); //lets you write text into tag
        $("#total-cart").html( shoppingCart.totalCart() );
      }

      $("#show-cart").on("click", ".delete-item", function(event){
          var name = $(this).attr("data-name");
          shoppingCart.removeItemFromCartAll(name); 
          displayCart();
      });

      $("#show-cart").on("click", ".subtract-item", function(event){ //jquery on convenient
          var name = $(this).attr("data-name");
          shoppingCart.removeItemFromCart(name);
          displayCart();
      });

      $("#show-cart").on("click", ".plus-item", function(event){
          var name = $(this).attr("data-name");
          shoppingCart.addItemToCart(name, 0, 1);
          displayCart();
      });
      //*******************************
      // Shopping Cart functions

      var shoppingCart = {};
      shoppingCart.cart = [];

      shoppingCart.Item = function(name, price, count) {
          this.name = name
          this.price = price
          this.count = count
      };

      shoppingCart.addItemToCart = function(name, price, count) {
        for (var i in this.cart) {
          if (this.cart[i].name === name) {
              this.cart[i].count += count;
              this.saveCart();
              return;
          }
        }
        var item = new this.Item(name, price, count);
        this.cart.push(item);
        this.saveCart(); //this represents the owner of the current object; means this item belongs to the owner of this METHOD
      }

      shoppingCart.removeItemFromCart = function(name) { //Removes one item}
        for (var i in this.cart) {
            if (this.cart[i].name === name) { //"3" === 3 false
                this.cart[i].count --; //cart[i].count --
                if (this.cart[i].count === 0) {
                  this.cart.splice(i, 1);
                }
                break; 
          }
        }
        shoppingCart.saveCart();
      }

           
           shoppingCart.removeItemFromCartAll = function(name) {// removes all item name
        for (var i in this.cart) {
          if (this.cart[i].name === name) {
              this.cart.splice(i, 1);
              break;
           }
        }
        shoppingCart.saveCart();
      }

shoppingCart.clearCart = function() {
        this.cart = [];
        this.saveCart();
      }
      shoppingCart.countCart = function() { // -> return total count
        var totalCount = 0;
        for (var i in this.cart) {
          totalCount += this.cart[i].count;
        }

        return totalCount;
      }
      
      shoppingCart.totalCart = function() { // -> return total cost
        var totalCost = 0;
        for (var i in this.cart) {
          totalCost += this.cart[i].price * this.cart[i].count;
        }
        return totalCost.toFixed(2);
      }

      shoppingCart.listCart = function() { //-> array of Item
        var cartCopy = [];
        for (var i in this.cart) {
          var item = this.cart[i];
          var itemCopy = {};
          for (var p in item) {
            itemCopy[p] = item[p];
          }
          itemCopy.total= (item.price * item.count).toFixed(2); //toFixed(2) means 2 decimal places
          cartCopy.push(itemCopy);
        }
        return cartCopy;
      }

      shoppingCart.saveCart = function() {
        localStorage.setItem("shoppingCart", JSON.stringify(this.cart)); //jason turned it into string
      } 

      shoppingCart.loadCart = function() {
        this.cart = JSON.parse(localStorage.getItem("shoppingCart"));
      }

      shoppingCart.loadCart();
      displayCart(); //must display after you load the cart.

      console.log("Shopping Cart: cart");
      console.log("ShoppingCart.cart");
      //console.log("Global Cart:");
      //console.log(this.cart);
      

// cart : Array
// Item : Object/Class

// addItemToCart : Function
// removeItemFromCart : Function
// clearCart : Function
// countCart : Function
// totalCart : Function
// listCart : Function
// saveCart : Function
// loadCart : Function


    
    </script>
  </body>
</html>